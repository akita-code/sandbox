<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>15パズル</title>
    <style>
        body {
            font-family: Consolas, 'Courier New', Courier, Monaco, monospace;
            font-size: 64px;
        }

        table {
            border: solid 3px black;
        }

        table td {
            border: solid 1px gray;
            background-color: gray;
            color: orange;
            width: 100px;
            height: 100px;
            vertical-align: center;
            text-align: center;
        }
    </style>
</head>
<body>
    <table>
        <tr>
            <td id="td01"><span id="n01">01</span></td>
            <td id="td02"><span id="n02">02</span></td>
            <td id="td03"><span id="n03">03</span></td>
            <td id="td04"><span id="n04">04</span></td>
        </tr>
        <tr>
            <td id="td05"><span id="n05">05</span></td>
            <td id="td06"><span id="n06">06</span></td>
            <td id="td07"><span id="n07">07</span></td>
            <td id="td08"><span id="n08">08</span></td>
        </tr>
        <tr>
            <td id="td09"><span id="n09">09</span></td>
            <td id="td10"><span id="n10">10</span></td>
            <td id="td11"><span id="n11">11</span></td>
            <td id="td12"><span id="n12">12</span></td>
        </tr>
        <tr>
            <td id="td13"><span id="n13">13</span></td>
            <td id="td14"><span id="n14">14</span></td>
            <td id="td15"><span id="n15">15</span></td>
            <td id="td16"><span id="n16">　</span></td>
        </tr>
    </table>
<script>
    var pz = pz || {};
    pz = (function(){
        var SPACE = "　";

        var arr = Array.apply(null, new Array(16)).map(function(v, i){
            return document.getElementById("n" + ('00' + (i+1)).slice(-2));
        });

        // 数字の並びをシャッフル
        var shuffle = function (arr) {
            var numArr = ["01", "02", "03", "04", "05", "06", "07", "08"
                        , "09", "10", "11", "12", "13", "14", "15"];
            var len = numArr.length;

            while (len) {
                var i = Math.floor(Math.random() * len);
                var element = numArr[--len];
                numArr[len] = numArr[i];
                numArr[i] = element;
            }
            numArr.push(SPACE);

            for (var j in arr) {
                arr[j].innerText = numArr[j]
            }
        }

        shuffle(arr);

        var move = function(arr, text) {
            for (var i in arr) {
                if (arr[i].innerText===SPACE) {
                    arr[i].innerText = text;
                }
            }
        }

        return {
            SPACE: SPACE,
            arr: arr,
            move: move,
        };
    }());
    
    pz.arr[0].addEventListener('click', function(e){
        var i = 0;
        if (pz.arr[i+1].innerText===pz.SPACE || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[1].addEventListener('click', function(e){
        var i = 1;
        if (pz.arr[i-1].innerText===pz.SPACE || pz.arr[i+1].innerText===pz.SPACE
                || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[2].addEventListener('click', function(e){
        var i = 2;
        if (pz.arr[i-1].innerText===pz.SPACE || pz.arr[i+1].innerText===pz.SPACE
                || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[3].addEventListener('click', function(e){
        var i = 3;
        if (pz.arr[i-1].innerText===pz.SPACE || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[4].addEventListener('click', function(e){
        var i = 4;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i+1].innerText===pz.SPACE
                || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[5].addEventListener('click', function(e){
        var i = 5;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+1].innerText===pz.SPACE || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[6].addEventListener('click', function(e){
        var i = 6;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+1].innerText===pz.SPACE || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[7].addEventListener('click', function(e){
        var i = 7;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[8].addEventListener('click', function(e){
        var i = 8;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i+1].innerText===pz.SPACE
                || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[9].addEventListener('click', function(e){
        var i = 9;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+1].innerText===pz.SPACE || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[10].addEventListener('click', function(e){
        var i = 10;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+1].innerText===pz.SPACE || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[11].addEventListener('click', function(e){
        var i = 11;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+4].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[12].addEventListener('click', function(e){
        var i = 12;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i+1].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[13].addEventListener('click', function(e){
        var i = 13;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+1].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[14].addEventListener('click', function(e){
        var i = 14;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE
                || pz.arr[i+1].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
    pz.arr[15].addEventListener('click', function(e){
        var i = 15;
        if (pz.arr[i-4].innerText===pz.SPACE || pz.arr[i-1].innerText===pz.SPACE) {
            pz.move(pz.arr, this.innerText);
            this.innerText = pz.SPACE;
        }
    }, false);
</script> 
</body>
</html>